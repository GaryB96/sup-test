<!DOCTYPE html>

<html lang="en">
<head>
<meta content="
  default-src 'self';
  script-src 'self' https://www.gstatic.com 'unsafe-inline';
  style-src 'self' 'unsafe-inline';
  connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.googleapis.com;
  img-src 'self' data:;
  font-src 'self';
  object-src 'none';
  base-uri 'self';
  form-action 'self';
  frame-ancestors 'none';
  upgrade-insecure-requests;
" http-equiv="Content-Security-Policy"/>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="data:," rel="icon"/>
<title>Supplement Tracker</title>
<link href="style.css?v=9" rel="stylesheet">
<link href="notifications.css" rel="stylesheet"/>
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
<style>
    body:not(.logged-in) #appContent { display: none; }
    body.logged-in #authContainer { display: none; }
    #authContainer { margin-bottom: 20px; }
    .modal.hidden { display: none; }

    /* Modal base */
    .modal { 
      position: fixed; inset: 0; 
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      padding: 20px;
    }
    .modal.hidden { display: none; }
    .modal-content {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    .modal-actions {
      display: flex; gap: 10px; justify-content: flex-end; margin-top: 16px;
    }
    .btn-secondary { background: #e0e0e0; color:#333; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
    .btn-danger { background: #e53935; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
    .btn-secondary:hover { background:#d5d5d5; }
    .btn-danger:hover { background:#c62828; }
    #confirmPasswordInput { width:90%; padding:10px; border:1px solid #ccc; border-radius:8px; margin-top:8px; }
</style>
</link></meta></head>
<!-- Notes Modal -->
<div aria-describedby="notesModalDesc" aria-labelledby="notesModalTitle" aria-modal="true" class="modal hidden" id="notesModal" role="dialog">
<div class="modal-content modal-notes" role="document">
<div class="modal-header">
<div class="modal-title-wrap">
<h2 class="modal-title" id="notesModalTitle">Notes</h2>
<p class="modal-subtitle" id="notesModalDesc">Your personal note. It autosaves as you type.</p>
</div>
<button aria-label="Close notes" class="icon-btn close-btn" id="closeNotesBtn">
        √ó
      </button>
</div>
<div class="modal-body">
<textarea class="notes-textarea" id="notesTextarea" placeholder="Write your notes here‚Ä¶" rows="12"></textarea>
</div>
<div class="modal-footer">
<span aria-live="polite" class="status-pill" id="notesStatus" role="status"> </span>
<div aria-hidden="true" class="kbd-hint">
</div>
</div>
</div>
</div>
<body>

<aside id="sidebar" class="sidebar hidden" role="navigation" aria-label="App controls">
  <button id="logoutBtn" class="sidebar-btn">Logout</button>
  <!-- Account Options dropdown -->
  <div class="dropdown">
<button class="profile-button" id="profileButton">Account Options</button>
<div class="dropdown-content" id="profileDropdown">
<a href="#" id="resetPassword">Reset Password</a>
<a href="#" id="deleteAccount">Delete Account</a>
<a href="#" id="openNotifications">Download Calendar</a>
</div>
</div>
  <button id="notesBtn" class="sidebar-btn">Notes</button>
  <button id="addSupplementBtn" class="sidebar-btn">Add New Supplement</button>
  <img id="icon" src="./assets/logo-icon.svg" alt="logo" class="banner-logo">
</aside>
</div><div aria-live="polite" class="status-pill" id="app-status" role="status"></div>
</div>
<main>
<!-- üîê Auth Section -->
<section id="authContainer">
<section id="authIntro" aria-label="Welcome">
  <div class="logo-wrap">
    <img id="authLogo" src="./assets/logo-combined-wordmark.svg"
         alt="Supplement Tracker ‚Äî Plan, track, and stay consistent with your daily supplements." />
  </div>
  <p class="auth-desc">Ideal for busy students, educators, athletes, and anyone who wants a simple way to <br>organize routines, log intake, and keep track of supplement cycles.</p>
</section>
<div aria-label="Account access" class="auth-card" role="region">
<div aria-label="Auth tabs" class="tabs" role="tablist">
<button aria-controls="signinPane" aria-selected="true" class="tab active" data-tab="signin" id="tabSignIn" role="tab">Sign In</button>
<button aria-controls="signupPane" aria-selected="false" class="tab" data-tab="signup" id="tabSignUp" role="tab">Create Account</button>
</div>
<!-- Sign In -->
<form aria-labelledby="tabSignIn" class="tab-pane active" id="signinForm" novalidate="" role="tabpanel">
<label for="signinEmail">Email</label>
<input id="signinEmail" placeholder="you@example.com" required="" type="email"/>
<label for="signinPassword">Password</label>
<input id="signinPassword" required="" type="password"/>
<div class="auth-row">
<button class="btn-primary" id="signinSubmit" type="submit">Sign In</button>
<a class="link" href="#" id="forgotPasswordLink">Forgot password?</a>
</div>
</form>
<!-- Sign Up -->
<form aria-labelledby="tabSignUp" class="tab-pane" id="signupForm" novalidate="" role="tabpanel">
<label for="signupEmail">Email</label>
<input id="signupEmail" placeholder="you@example.com" required="" type="email"/>
<label for="signupPassword">Password</label>
<input id="signupPassword" placeholder="At least 6 characters" required="" type="password"/>
<label for="signupPassword2">Confirm password</label>
<input id="signupPassword2" placeholder="Re-enter password" required="" type="password"/>
<div class="muted small" id="passwordHelp">Use at least 6 characters.</div>
<button class="btn-primary" id="signupSubmit" type="submit">Create Account</button>
<div class="muted small">We'll send a verification email to activate your account.</div>
</form>
<div aria-live="polite" class="status-pill" id="auth-status" role="status"></div>
</div>
</section>
<!-- ‚úÖ Main App Content -->
<section id="appContent">
<div aria-labelledby="confirmDeleteTitle" aria-modal="true" class="modal hidden" id="confirmDeleteModal" role="dialog">
<div class="modal-content">
<h2 id="confirmDeleteTitle">Delete account?</h2>
<p>This action permanently removes your data. Are you sure?</p>
<div class="modal-actions">
<button class="btn-secondary" id="confirmDeleteNo" type="button">No, cancel</button>
<button class="btn-danger" id="confirmDeleteYes" type="button">Yes, delete</button>
</div>
</div>
</div>
<!-- ‚úÖ Fixed: Password Confirmation Modal matches modal styles/IDs -->
<div aria-labelledby="passwordConfirmTitle" aria-modal="true" class="modal hidden" id="passwordConfirmModal" role="dialog">
<div class="modal-content">
<h3 id="passwordConfirmTitle">Confirm Account Deletion</h3>
<p>Please enter your password to confirm:</p>
<input id="confirmPasswordInput" placeholder="Password" type="password"/>
<div class="modal-actions">
<button class="btn-secondary" id="passwordCancelBtn" type="button">Cancel</button>
<button class="btn-danger" id="passwordConfirmBtn" type="button">Delete</button>
</div>
</div>
</div>
<form id="supplementForm">
  <h1>Supplement Summary</h1>
</form>
<div class="summary-container" id="supplementSummaryContainer"></div>
<div id="calendarContainer">
<h1>Cycle Calendar</h1>
<div class="calendar-nav">
<button id="prevBtn">‚óÄ Previous</button>
<span id="currentMonthLabel"></span>
<button id="nextBtn">Next ‚ñ∂</button>
</div>
<div id="calendar"></div>
</div>
</section>
<!-- Notifications Modal -->
<div aria-labelledby="notificationsTitle" aria-modal="true" class="modal hidden" id="notificationsModal" role="dialog">
<div class="modal-content"> <!-- if you currently have .noty-card, keep it AND add this class -->
<div style="display:flex;justify-content:space-between;align-items:center;">
<h2 id="notificationsTitle" style="margin:0;">Calendar</h2>
<button aria-label="Close" id="notificationsCloseBtn">‚úï</button>
</div>
<div class="noty-row">
<p>Download a calendar with ‚Äúday-before‚Äù reminders for the next year.</p>
<p class="muted">
  Tip: create a <em>separate</em> calendar (e.g., ‚ÄúSupplements / Cycles‚Äù) before importing this file.
  That way you can toggle it on/off or delete it without touching your main calendar.</p>
<button id="notificationsIcsBtn">Download</button>
</div>
<div class="noty-actions">
</div>
</div>
</div>

<!-- Add New Supplement Modal -->
<div id="supplementModal" class="modal hidden" role="dialog" aria-modal="true"
     aria-labelledby="supplementModalTitle" aria-describedby="supplementModalDesc" tabindex="-1">
  <div class="modal-backdrop" data-close-modal></div>

  <div class="modal-content" role="document">
    <button class="modal-close" type="button" aria-label="Close" data-close-modal>√ó</button>

    <h2 id="supplementModalTitle">Add New Supplement</h2>
    <p id="supplementModalDesc" class="modal-desc">Fill in the details and click Save.</p>

    <!-- CHANGED: unique form id -->
    <form id="supplementModalForm">
      <div class="form-row">
        <label for="suppName">Name</label>
        <input id="suppName" name="name" type="text" required />
      </div>

      <div class="form-row">
        <label for="suppDosage">Dosage</label>
        <input id="suppDosage" placeholder="e.g., 500mg" name="dosage" type="text" />
      </div>

<!-- Time of day -->
<div class="form-row">
  <div class="time-grid">
    <label class="time-item">
      <input type="checkbox" name="time" value="Morning">
      <span>Morning</span>
    </label>
    <label class="time-item">
      <input type="checkbox" name="time" value="Afternoon">
      <span>Afternoon</span>
    </label>
    <label class="time-item">
      <input type="checkbox" name="time" value="Evening">
      <span>Evening</span>
    </label>
  </div>
</div>
<!-- Cycle toggle + Start Date -->
<div class="form-row form-row-inline">
  <label class="cycle-inline">
    <input type="checkbox" id="suppCycleChk" name="cycle" value="1">
    <span>On a cycle?</span>
  </label>

  <!-- keep space reserved; hide visually when off -->
  <div id="suppCycleStartWrap" class="cycle-start is-hidden">
    <input type="date" id="suppCycleStart" name="startDate">
    <input type="number" id="suppDaysOn" placeholder="Days On" name="onDay">
    <input type="number" id="suppDaysOff" placeholder="Days Off" name="offDay">
    <span class="field-caption">Start Date</span>
  </div>
</div>


      <!-- FOOTER: Save (left) + Cancel (right) -->
      <div class="modal-actions modal-actions--split">
        <button type="submit" id="saveSupplementBtn" class="btn-primary">Save</button>
        <button type="button" id="cancelSupplementBtn" class="btn-secondary" data-close-modal>Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Duplicate close button support
  document.getElementById('notificationsCloseBtnBottom')?.addEventListener('click', () => {
    document.getElementById('notificationsCloseBtn')?.click();
  });
</script>
</main>
<script src="./js/toast.js" type="module"></script>
<script src="./js/main.js" type="module"></script>
<script src="./js/supplementsUI.js" type="module"></script>
<script src="./js/notifications.js" type="module"></script>
</body>
</html>
